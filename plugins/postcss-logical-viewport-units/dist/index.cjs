"use strict";var e=require("@csstools/css-tokenizer");function hasFeature(t){{const e=t.toLowerCase();if(!e.includes("vb")&&!e.includes("vi"))return!1}const r=e.tokenizer({css:t});for(;;){const t=r.nextToken();if(t[0]===e.TokenType.EOF)break;if(t[0]!==e.TokenType.Dimension)continue;const n=t[4].unit.toLowerCase();if("vb"===n||"vi"===n)return!0}return!1}function hasSupportsAtRuleAncestor(e){let t=e.parent;for(;t;)if("atrule"===t.type){if("supports"===t.name.toLowerCase()&&hasFeature(t.params))return!0;t=t.parent}else t=t.parent;return!1}function transform(t,r){const n=e.tokenizer({css:t}),o=[];let s=!1;for(;;){const t=n.nextToken();if(o.push(t),t[0]===e.TokenType.EOF)break;if(t[0]!==e.TokenType.Dimension)continue;const i=r[t[4].unit.toLowerCase()];i&&(t[1]=t[4].value.toString()+i,t[4].unit=i,s=!0)}return s?e.stringify(...o):t}const creator=e=>{const t=Object.assign({writingMode:"horizontal",preserve:!0},e);"vertical"!==t.writingMode&&(t.writingMode="horizontal");const r={vb:"vh",vi:"vw"};return"vertical"===t.writingMode&&(r.vb="vw",r.vi="vh"),{postcssPlugin:"postcss-logical-viewport-units",Declaration(e,{atRule:n}){{const t=e.value.toLowerCase();if(!t.includes("vb")&&!t.includes("vi"))return;const r=e.prev();if(r&&"decl"===r.type&&r.prop===e.prop)return;if(hasSupportsAtRuleAncestor(e))return}const o=transform(e.value,r);if(o===e.value)return;if(e.cloneBefore({value:o}),!t.preserve)return void e.remove();if(!e.variable)return;const s=n({name:"supports",params:"(top: 1vi)",source:e.source}),i=e.parent,u=e.parent.cloneAfter({nodes:[]});u.append(e),s.append(u),i.after(s)}}};creator.postcss=!0,module.exports=creator;
