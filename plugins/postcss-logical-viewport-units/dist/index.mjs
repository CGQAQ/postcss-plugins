import{tokenizer as e,TokenType as t,stringify as r}from"@csstools/css-tokenizer";function hasFeature(r){{const e=r.toLowerCase();if(!e.includes("vb")&&!e.includes("vi"))return!1}const n=e({css:r});for(;;){const e=n.nextToken();if(e[0]===t.EOF)break;if(e[0]!==t.Dimension)continue;const r=e[4].unit.toLowerCase();if("vb"===r||"vi"===r)return!0}return!1}function hasSupportsAtRuleAncestor(e){let t=e.parent;for(;t;)if("atrule"===t.type){if("supports"===t.name.toLowerCase()&&hasFeature(t.params))return!0;t=t.parent}else t=t.parent;return!1}function transform(n,o){const s=e({css:n}),i=[];let a=!1;for(;;){const e=s.nextToken();if(i.push(e),e[0]===t.EOF)break;if(e[0]!==t.Dimension)continue;const r=o[e[4].unit.toLowerCase()];r&&(e[1]=e[4].value.toString()+r,e[4].unit=r,a=!0)}return a?r(...i):n}const creator=e=>{const t=Object.assign({writingMode:"horizontal",preserve:!0},e);"vertical"!==t.writingMode&&(t.writingMode="horizontal");const r={vb:"vh",vi:"vw"};return"vertical"===t.writingMode&&(r.vb="vw",r.vi="vh"),{postcssPlugin:"postcss-logical-viewport-units",Declaration(e,{atRule:n}){{const t=e.value.toLowerCase();if(!t.includes("vb")&&!t.includes("vi"))return;const r=e.prev();if(r&&"decl"===r.type&&r.prop===e.prop)return;if(hasSupportsAtRuleAncestor(e))return}const o=transform(e.value,r);if(o===e.value)return;if(e.cloneBefore({value:o}),!t.preserve)return void e.remove();if(!e.variable)return;const s=n({name:"supports",params:"(top: 1vi)",source:e.source}),i=e.parent,a=e.parent.cloneAfter({nodes:[]});a.append(e),s.append(a),i.after(s)}}};creator.postcss=!0;export{creator as default};
