"use strict";var e=require("postcss-selector-parser");const r=new Set(["scope","container"]);function isProcessableCustomSelectorRule(e){if("atrule"!==e.type)return!1;if("custom-selector"!==e.name.toLowerCase())return!1;if(!e.params||!e.params.includes(":--"))return!1;if(e.nodes&&e.nodes.length>0)return!1;let t=e.parent;for(;t;){if("rule"===t.type)return!1;if("atrule"===t.type&&!r.has(t.name.toLowerCase()))return!1;t=t.parent}return!0}function getCustomSelectors(r,t,s){const o=new Map;return r.walkAtRules((r=>{if(isProcessableCustomSelectorRule(r))try{var n,c,l;const t=r.params.trim(),a=e().astSync(t),u=null==a||null==(n=a.nodes)||null==(c=n[0])||null==(l=c.nodes)?void 0:l[0];if(!u||"pseudo"!==u.type||!u.value.startsWith(":--"))return;const p=u.toString();if(o.set(p,e().astSync(t.slice(p.length).trim())),!s.preserve){const e=r.parent;r.remove(),removeEmptyAncestorBlocks(e)}}catch(e){r.warn(t,`Failed to parse custom selector : "${r.params}" with message: "${e.message}"`)}})),o}function removeEmptyAncestorBlocks(e){let r=e;for(;r;){if(r.nodes&&r.nodes.length>0)return;const e=r.parent;r.remove(),r=e}}var transformRule=(r,t,s,o)=>{let n=r.selector;try{n=e((r=>{r.walkPseudos((r=>{if(!s.has(r.value))return;const t=e.pseudo({value:":is",nodes:[]});s.get(r.value).each((e=>{t.append(e.clone({}))})),r.replaceWith(t)}))})).processSync(r.selector)}catch(e){return void r.warn(t,`Failed to parse selector : "${n}" with message: "${e.message}"`)}n!==r.selector&&(r.cloneBefore({selector:n}),o.preserve||r.remove())};const creator=e=>{const r=Boolean(Object(e).preserve);if("importFrom"in Object(e))throw new Error('[postcss-custom-selectors] "importFrom" is no longer supported');if("exportTo"in Object(e))throw new Error('[postcss-custom-selectors] "exportTo" is no longer supported');return{postcssPlugin:"postcss-custom-selectors",prepare(){let e=new Map;return{Once:(t,{result:s})=>{e=getCustomSelectors(t,s,{preserve:r})},Rule:(t,{result:s})=>{t.selector.includes(":--")&&transformRule(t,s,e,{preserve:r})}}}}};creator.postcss=!0,module.exports=creator;
